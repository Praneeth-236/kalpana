<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emergency Profile - CareMatch AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <div class="container">
        <h1>Emergency Medical Profile</h1>
        <p class="subtitle">Live data fetched in real time from CareMatch database</p>

        <div class="card">
            <h2>Patient Name</h2>
            <p>{{ user['name'] }}</p>
            <h2>Condition</h2>
            <p>{{ user['medical_conditions'] or user['condition'] or 'Not Provided' }}</p>
            <h2>Blood Group</h2>
            <p>{{ user['blood_group'] or 'Not Provided' }}</p>
            <h2>Allergies</h2>
            <p>{{ user['allergies'] or 'Not Provided' }}</p>
        </div>

        <div class="card">
            <h2>Medications</h2>
            {% for item in prescriptions %}
            <p><strong>{{ item['medicine_name'] }}</strong> — {{ item['dosage'] }}, {{ item['frequency'] }}</p>
            <p>Instructions: {{ item['instructions'] or 'N/A' }}</p>
            <p>Prescribed by: {{ item['doctor_name'] or 'Doctor' }}</p>
            <hr />
            {% else %}
            <p>No active prescriptions recorded.</p>
            {% endfor %}
        </div>

        <div class="card">
            <h2>Emergency Contacts</h2>
            {% for contact in emergency_contacts %}
            <p><strong>{{ contact['name'] }}</strong> ({{ contact['relationship'] or 'Contact' }})</p>
            <p>{{ contact['contact'] }}</p>
            {% if contact['contact'] and contact['contact'] != 'Not Provided' %}
            <a class="btn" href="tel:{{ contact['contact'] }}">Call</a>
            {% endif %}
            <hr />
            {% else %}
            <p>No emergency contacts available.</p>
            {% endif %}
        </div>

        <div class="card">
            <h2>Latest Health Summary</h2>
            {% set state = health_summary['state'] %}
            {% set latest = health_summary['latest_assessment'] %}
            {% if state %}
            <p><strong>Trend:</strong> {{ state['trend'] or 'N/A' }}</p>
            <p><strong>Stress Score:</strong> {{ state['stress_score'] if state['stress_score'] is not none else 'N/A' }}</p>
            <p><strong>Energy Score:</strong> {{ state['energy_score'] if state['energy_score'] is not none else 'N/A' }}</p>
            <p><strong>Recommendation:</strong> {{ state['recommendation'] or 'N/A' }}</p>
            <p><strong>Last Updated:</strong> {{ state['last_updated'] or 'N/A' }}</p>
            {% else %}
            <p>No adaptive health summary available.</p>
            {% endif %}

            {% if latest %}
            <p><strong>Latest Assessment Entry:</strong> {{ latest['question'] }} → {{ latest['answer'] }} ({{ latest['timestamp'] }})</p>
            {% endif %}
        </div>

        <div class="card">
            <h2>Risk Level</h2>
            <p><strong>{{ risk_level }}</strong></p>
            {% if health_summary['state'] and health_summary['state']['risk_reason'] %}
            <p>{{ health_summary['state']['risk_reason'] }}</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
